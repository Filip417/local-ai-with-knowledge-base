<div
  class="panel-component history-panel"
  [class.is-collapsed]="isCollapsed()"
  [style.width]="panelWidth()"
  role="region"
  aria-label="Conversation history"
>
  <div class="panel-header history-header">
    <span class="history-title">History</span>
    <button
      type="button"
      class="collapse-btn"
      (click)="toggleCollapsed()"
      [attr.aria-expanded]="!isCollapsed()"
      aria-label="Toggle history panel"
    >
      <span aria-hidden="true" *ngIf="isCollapsed()">&lt;</span>
      <span aria-hidden="true" *ngIf="!isCollapsed()">&gt;</span>
    </button>
  </div>

  <div class="panel-inside history-body" >
    <div 
      class="history-item" 
      *ngFor="let item of historyItems()"
      (click)="onItemClick(item.id)"
      role="button"
      tabindex="0"
      [attr.aria-label]="'Load conversation: ' + item.title"
    >
      <div class="history-item__title" *ngIf="!isCollapsed()">{{ item.title }}</div>
      <div class="history-item__meta" *ngIf="!isCollapsed()">{{ relativeTime(item.timestamp) }}</div>
      <div class="history-item__snippet" *ngIf="!isCollapsed()">{{ item.lastMessage }}</div>
      <button 
        class="delete-btn" 
         *ngIf="!isCollapsed()"
        (click)="$event.stopPropagation(); deleteSelectedSession(item.id)"
        aria-label="Delete session"
        title="Delete session"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 6h18"></path>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          <line x1="10" y1="11" x2="10" y2="17"></line>
          <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
      </button>
    </div>

    <div class="empty-state" *ngIf="!historyItems().length && !isLoading() && !isCollapsed()">
      <h3>No history yet</h3>
      <p>Conversations will appear here once saved.</p>
    </div>

    <div class="empty-state" *ngIf="isLoading()">
      <p>Loading history...</p>
    </div>
  </div>
</div>
